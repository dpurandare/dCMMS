# ==========================================
# dCMMS Environment Configuration Template
# ==========================================
# Copy this file to .env and fill in actual values
# IMPORTANT: Never commit .env file with real secrets!

# ==========================================
# APPLICATION
# ==========================================
NODE_ENV=development  # development, staging, production
APP_NAME=dCMMS
APP_VERSION=1.0.0
APP_PORT=3000
APP_HOST=0.0.0.0

# ==========================================
# DATABASE - PostgreSQL (Transactional)
# ==========================================
# Format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://dcmms_user:changeme@localhost:5432/dcmms
DATABASE_POOL_MIN=5
DATABASE_POOL_MAX=25
DATABASE_SSL=false  # Set to true in production
DATABASE_TIMEZONE=UTC

# ==========================================
# DATABASE - QuestDB (Time-Series Raw Data)
# ==========================================
QUESTDB_HOST=localhost
QUESTDB_PORT_HTTP=9000
QUESTDB_PORT_PG=8812
QUESTDB_USER=admin
QUESTDB_PASSWORD=quest
# Connection string for PostgreSQL wire protocol
QUESTDB_URL=postgresql://admin:quest@localhost:8812/qdb

# ==========================================
# DATABASE - TimescaleDB (Time-Series Aggregates)
# ==========================================
TIMESCALEDB_URL=postgresql://timescale_user:changeme@localhost:5433/timescaledb
TIMESCALEDB_POOL_MIN=3
TIMESCALEDB_POOL_MAX=15

# ==========================================
# CACHE - Redis
# ==========================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=  # Leave empty for no password (dev only)
REDIS_DB=0
REDIS_TLS=false  # Set to true in production
# Alternative: Use connection string
# REDIS_URL=redis://:password@localhost:6379/0

# ==========================================
# MESSAGE BROKER - Kafka
# ==========================================
KAFKA_BROKERS=localhost:9092,localhost:9093,localhost:9094
KAFKA_CLIENT_ID=dcmms-api
KAFKA_GROUP_ID=dcmms-consumer-group
KAFKA_SASL_ENABLED=false  # Set to true in production
KAFKA_SASL_MECHANISM=SCRAM-SHA-512
KAFKA_SASL_USERNAME=
KAFKA_SASL_PASSWORD=
KAFKA_SSL_ENABLED=false  # Set to true in production

# Kafka Topics
KAFKA_TOPIC_TELEMETRY_RAW=telemetry.raw
KAFKA_TOPIC_TELEMETRY_VALIDATED=telemetry.validated
KAFKA_TOPIC_ALERTS_CRITICAL=alerts.critical
KAFKA_TOPIC_WORKORDERS=workorders.events
KAFKA_TOPIC_AUDIT_LOGS=audit.logs

# ==========================================
# MESSAGE BROKER - EMQX MQTT
# ==========================================
MQTT_BROKER_URL=mqtt://localhost:1883
MQTT_USERNAME=
MQTT_PASSWORD=
MQTT_CLIENT_ID=dcmms-backend
MQTT_TLS=false  # Set to true in production
MQTT_CA_CERT_PATH=  # Path to CA certificate for TLS

# ==========================================
# AUTHENTICATION - JWT
# ==========================================
JWT_SECRET=changeme-use-a-long-random-string-at-least-64-characters-long!
JWT_ACCESS_TOKEN_EXPIRY=15m  # 15 minutes
JWT_REFRESH_TOKEN_EXPIRY=7d  # 7 days
JWT_ALGORITHM=RS256  # Use RS256 for production (requires private/public keys)

# JWT Keys (for RS256 - production only)
JWT_PRIVATE_KEY_PATH=  # Path to private key file
JWT_PUBLIC_KEY_PATH=   # Path to public key file

# ==========================================
# IDENTITY PROVIDER (IdP) ADAPTER
# ==========================================
# Provider: auth0, azure-ad, keycloak, okta
IDP_PROVIDER=auth0
IDP_TENANT_ID=  # For multi-tenant setups

# Auth0 Configuration
AUTH0_DOMAIN=your-tenant.auth0.com
AUTH0_CLIENT_ID=your-client-id
AUTH0_CLIENT_SECRET=your-client-secret
AUTH0_AUDIENCE=https://api.dcmms.io
AUTH0_CALLBACK_URL=http://localhost:3000/api/v1/auth/callback

# Azure AD Configuration
AZURE_AD_TENANT_ID=
AZURE_AD_CLIENT_ID=
AZURE_AD_CLIENT_SECRET=
AZURE_AD_REDIRECT_URI=

# Keycloak Configuration
KEYCLOAK_BASE_URL=http://localhost:8080
KEYCLOAK_REALM=dcmms
KEYCLOAK_CLIENT_ID=
KEYCLOAK_CLIENT_SECRET=

# ==========================================
# SECRETS MANAGEMENT - HashiCorp Vault
# ==========================================
VAULT_ENABLED=false  # Set to true in production
VAULT_ADDR=http://localhost:8200
VAULT_TOKEN=root  # Dev token only! Use AppRole in production
VAULT_NAMESPACE=  # Enterprise Vault only
VAULT_PATH_PREFIX=secret/data/dcmms

# ==========================================
# OBJECT STORAGE - S3 Compatible
# ==========================================
# AWS S3 / MinIO / Azure Blob (S3-compatible API)
S3_ENDPOINT=http://localhost:9002  # MinIO for local dev (port 9000 used by QuestDB)
S3_REGION=us-east-1
S3_ACCESS_KEY_ID=minioadmin  # Change for production!
S3_SECRET_ACCESS_KEY=minioadmin  # Change for production!
S3_BUCKET_DOCUMENTS=dcmms-documents
S3_BUCKET_TELEMETRY=dcmms-telemetry-lakehouse
S3_BUCKET_ML_MODELS=dcmms-ml-models
S3_USE_SSL=false  # Set to true in production
S3_FORCE_PATH_STYLE=true  # Required for MinIO

# ==========================================
# NOTIFICATIONS
# ==========================================

# ==========================================
# EMAIL NOTIFICATIONS
# ==========================================
# Provider: sendgrid, ses, smtp, console (console for dev/testing)
EMAIL_PROVIDER=console
EMAIL_FROM=noreply@dcmms.local
EMAIL_FROM_NAME=dCMMS System

# SendGrid Configuration
SENDGRID_API_KEY=

# AWS SES Configuration
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# SMTP Configuration (Alternative to SendGrid/SES)
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_SECURE=false  # true for 465, false for 587
SMTP_USER=
SMTP_PASSWORD=

# ==========================================
# SMS NOTIFICATIONS
# ==========================================
# Provider: twilio, sns, console (console for dev/testing)
SMS_PROVIDER=console
SMS_FROM_NUMBER=+10000000000

# Twilio Configuration
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=

# AWS SNS Configuration
# (Uses AWS credentials from EMAIL_NOTIFICATIONS section)

# ==========================================
# PUSH NOTIFICATIONS
# ==========================================
# Firebase Cloud Messaging (FCM)
FCM_ENABLED=false
FCM_SERVER_KEY=
FCM_PROJECT_ID=
FCM_CLIENT_EMAIL=
FCM_PRIVATE_KEY=
# Alternative: Use service account JSON file
GOOGLE_APPLICATION_CREDENTIALS=config/firebase-adminsdk.json

# ==========================================
# EXTERNAL APIs
# ==========================================

# Weather API (OpenWeatherMap, WeatherAPI, etc.)
WEATHER_API_PROVIDER=openweathermap
WEATHER_API_KEY=
WEATHER_API_BASE_URL=https://api.openweathermap.org/data/2.5

# ==========================================
# OBSERVABILITY
# ==========================================

# Logging
LOG_LEVEL=info  # error, warn, info, debug, trace
LOG_FORMAT=json  # json, pretty (pretty for dev only)
LOG_FILE_ENABLED=true
LOG_FILE_PATH=logs/dcmms.log
LOG_FILE_MAX_SIZE=10m
LOG_FILE_MAX_FILES=10

# Metrics - Prometheus
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090
PROMETHEUS_PATH=/metrics

# Tracing - Jaeger
JAEGER_ENABLED=false  # Set to true for distributed tracing
JAEGER_AGENT_HOST=localhost
JAEGER_AGENT_PORT=6831
JAEGER_SERVICE_NAME=dcmms-api
JAEGER_SAMPLER_TYPE=probabilistic  # const, probabilistic, ratelimiting
JAEGER_SAMPLER_PARAM=0.1  # 10% sampling

# Error Tracking - Sentry
SENTRY_ENABLED=false
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=0.1

# ==========================================
# RATE LIMITING
# ==========================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_MAX_REQUESTS=100  # Requests per window
RATE_LIMIT_WINDOW_MS=60000   # 1 minute
RATE_LIMIT_SKIP_SUCCESSFUL=false

# ==========================================
# CORS (Cross-Origin Resource Sharing)
# ==========================================
CORS_ENABLED=true
CORS_ORIGIN=http://localhost:4200,http://localhost:3001  # Comma-separated origins
CORS_CREDENTIALS=true

# ==========================================
# FRONTEND URLs
# ==========================================
FRONTEND_WEB_URL=http://localhost:4200
FRONTEND_MOBILE_URL=dcmms://

# ==========================================
# FEATURE FLAGS
# ==========================================
FEATURE_ML_PREDICTIONS=false  # Enable ML predictions
FEATURE_COMPLIANCE_REPORTS=true
FEATURE_COST_MANAGEMENT=false
FEATURE_EDGE_COMPUTING=false
FEATURE_MULTI_LANGUAGE=false  # i18n support

# ==========================================
# MULTI-TENANCY
# ==========================================
MULTI_TENANT_ENABLED=true
DEFAULT_TENANT_ID=default

# ==========================================
# DEPLOYMENT
# ==========================================
KUBERNETES_NAMESPACE=dcmms
DEPLOYMENT_ENVIRONMENT=local  # local, dev, staging, production
CLUSTER_NAME=dcmms-local

# Health Check
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_TIMEOUT=5000  # milliseconds

# Graceful Shutdown
SHUTDOWN_TIMEOUT=10000  # milliseconds

# ==========================================
# DEVELOPMENT / TESTING
# ==========================================
# Mock external services for testing
MOCK_IDP=false
MOCK_EMAIL=true
MOCK_SMS=true
MOCK_WEATHER_API=true
MOCK_SCADA=true

# Seed data
SEED_DATA_ENABLED=true  # Auto-seed database on startup (dev only)

# API Documentation
API_DOCS_ENABLED=true  # Swagger UI at /api/docs
API_DOCS_PATH=/api/docs

# ==========================================
# PERFORMANCE TUNING
# ==========================================
# Node.js
NODE_OPTIONS=--max-old-space-size=4096  # 4GB heap

# Worker Threads
WORKER_THREADS_COUNT=4  # Number of worker threads for CPU-intensive tasks

# Database Query Timeout
DATABASE_QUERY_TIMEOUT=30000  # 30 seconds

# HTTP Timeout
HTTP_TIMEOUT=30000  # 30 seconds

# ==========================================
# SECURITY
# ==========================================
# Encryption at rest
ENCRYPTION_KEY=changeme-use-a-32-byte-key-for-aes-256!
ENCRYPTION_ALGORITHM=aes-256-gcm

# Password Hashing
PASSWORD_HASH_ROUNDS=12  # bcrypt rounds

# Session Security
SESSION_SECRET=changeme-use-a-long-random-string!
SESSION_COOKIE_SECURE=false  # Set to true in production (requires HTTPS)
SESSION_COOKIE_HTTP_ONLY=true
SESSION_COOKIE_SAME_SITE=strict  # strict, lax, none

# Content Security Policy
CSP_ENABLED=true

# ==========================================
# MOBILE APP SYNC
# ==========================================
SYNC_BATCH_SIZE=100  # Number of records per sync batch
SYNC_CONFLICT_RESOLUTION=server_wins  # server_wins, client_wins, last_write_wins
SYNC_MAX_OFFLINE_DAYS=7  # Maximum offline period before full re-sync

# ==========================================
# BATCH PROCESSING
# ==========================================
# Apache Flink
FLINK_JOBMANAGER_HOST=localhost
FLINK_JOBMANAGER_PORT=8081

# Apache Airflow
AIRFLOW_HOST=localhost
AIRFLOW_PORT=8080
AIRFLOW_USERNAME=admin
AIRFLOW_PASSWORD=admin

# ==========================================
# ML/AI PLATFORM
# ==========================================
# Feast Feature Store
FEAST_ENABLED=false
FEAST_REGISTRY_PATH=s3://dcmms-ml-models/feast-registry
FEAST_ONLINE_STORE_TYPE=redis
FEAST_OFFLINE_STORE_TYPE=file  # file, s3, bigquery, snowflake

# MLflow
MLFLOW_TRACKING_URI=http://localhost:5000
MLFLOW_ARTIFACT_ROOT=s3://dcmms-ml-models/mlflow-artifacts
MLFLOW_EXPERIMENT_NAME=dcmms-predictive-maintenance

# KServe (Model Serving)
KSERVE_ENABLED=false
KSERVE_INFERENCE_URL=http://localhost:8080

# ==========================================
# EDGE COMPUTING
# ==========================================
EDGE_GATEWAY_ID=  # Unique ID for this edge gateway
EDGE_SITE_ID=     # Site ID for this edge deployment
EDGE_SYNC_INTERVAL=300000  # 5 minutes in milliseconds
EDGE_BUFFER_SIZE_MB=1024   # 1GB local buffer
EDGE_OFFLINE_MODE=false    # Force offline mode for testing

# ==========================================
# DEVELOPER TOOLS
# ==========================================
DEBUG=false  # Enable debug mode
PRETTY_PRINT_LOGS=true  # Pretty print logs in development
HOT_RELOAD=true  # Hot reload for development

# ==========================================
# END OF CONFIGURATION
# ==========================================
